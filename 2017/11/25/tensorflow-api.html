<!-- build time:Sun Dec 03 2017 22:47:22 GMT+0800 (CST) --><!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css"><meta name="keywords" content="Tensorflow,"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2"><meta name="description" content="Tensorflow API 整理，方便自己查阅"><meta name="keywords" content="Tensorflow"><meta property="og:type" content="article"><meta property="og:title" content="Tensorflow API 整理"><meta property="og:url" content="http://yoursite.com/2017/11/25/tensorflow-api.html"><meta property="og:site_name" content="JieXiao&#39;s Blog"><meta property="og:description" content="Tensorflow API 整理，方便自己查阅"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://yoursite.com/images/tensorflow_api/random_uniform_initializer.png"><meta property="og:updated_time" content="2017-11-30T14:59:10.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Tensorflow API 整理"><meta name="twitter:description" content="Tensorflow API 整理，方便自己查阅"><meta name="twitter:image" content="http://yoursite.com/images/tensorflow_api/random_uniform_initializer.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"5.1.2",sidebar:{position:"left",display:"always",offset:10,offset_float:10,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://yoursite.com/2017/11/25/tensorflow-api.html"><title>Tensorflow API 整理 | JieXiao's Blog</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">JieXiao's Blog</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/25/tensorflow-api.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="JIE XIAO"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="JieXiao's Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Tensorflow API 整理</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-25T15:04:15+08:00">2017-11-25 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/机器学习/" itemprop="url" rel="index"><span itemprop="name">机器学习</span> </a></span></span><span class="post-meta-divider">|</span> <span class="page-pv"><i class="fa fa-file-o"></i> 阅读 <span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><div class="note default"><p>Tensorflow API 整理，方便自己查阅</p></div><a id="more"></a><hr><h1 id="tf"><a href="#tf" class="headerlink" title="tf"></a>tf</h1><h2 id="Building-Graphs"><a href="#Building-Graphs" class="headerlink" title="Building Graphs"></a>Building Graphs</h2><h3 id="Defining-new-operations"><a href="#Defining-new-operations" class="headerlink" title="Defining new operations"></a>Defining new operations</h3><h4 id="tf-TensorShape"><a href="#tf-TensorShape" class="headerlink" title="tf.TensorShape"></a>tf.TensorShape</h4><ul><li>功能<br>表示某个 shape 的 Tensor</li></ul><h2 id="Constants-Sequences-and-Random-Values"><a href="#Constants-Sequences-and-Random-Values" class="headerlink" title="Constants, Sequences, and Random Values"></a>Constants, Sequences, and Random Values</h2><h3 id="Constant-Value-Tensors"><a href="#Constant-Value-Tensors" class="headerlink" title="Constant Value Tensors"></a>Constant Value Tensors</h3><h4 id="tf-fill"><a href="#tf-fill" class="headerlink" title="tf.fill"></a>tf.fill</h4><ul><li>功能<br>创建元素为同一标量的 Tensor</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">fill(</div><div class="line">    dims,</div><div class="line">    value,</div><div class="line">    name=None</div><div class="line">)</div><div class="line"></div><div class="line">Args:</div><div class="line">dims:  A Tensor of type int32. 1-D. Represents the shape of the output tensor.</div><div class="line">value: A Tensor. 0-D (scalar). Value to fill the returned tensor.</div><div class="line">name:  A name for the operation (optional).</div><div class="line"></div><div class="line">Returns:</div><div class="line">A Tensor. Has the same type as value.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ ipython</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">2</span>]: tmp = tf.fill([<span class="number">2</span>, <span class="number">3</span>], <span class="number">9</span>)</div><div class="line">In [<span class="number">3</span>]: <span class="keyword">with</span> tf.Session().as_default():</div><div class="line">   ...:     tmp.eval()</div><div class="line">Out[<span class="number">3</span>]:</div><div class="line">array([[<span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>],</div><div class="line">       [<span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>]], dtype=int32)</div></pre></td></tr></table></figure></li></ul><h3 id="Sequences"><a href="#Sequences" class="headerlink" title="Sequences"></a>Sequences</h3><h4 id="tf-range"><a href="#tf-range" class="headerlink" title="tf.range"></a>tf.range</h4><ul><li>功能<br>构建 tensor 序列</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">range(limit, delta=1, dtype=None, name=&apos;range&apos;)</div><div class="line">range(start, limit, delta=1, dtype=None, name=&apos;range&apos;)</div><div class="line"></div><div class="line">Args:</div><div class="line">start: 序列的起点，默认为 0, 包含</div><div class="line">limit: 序列的终点，不包含</div><div class="line">delta: 增量，可以为负</div><div class="line">dtype: 元素类型</div><div class="line">name:  A name for the operation. Defaults to &quot;range&quot;.</div><div class="line"></div><div class="line">Returns:</div><div class="line">An 1-D Tensor of type dtype.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ ipython3</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">2</span>]: <span class="keyword">with</span> tf.Session():</div><div class="line">   ...:     tf.range(<span class="number">5</span>).eval()</div><div class="line">   ...:     tf.range(<span class="number">3</span>, <span class="number">1</span>, <span class="number">-0.5</span>).eval()</div><div class="line">Out[<span class="number">2</span>]: array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], dtype=int32)</div><div class="line">Out[<span class="number">2</span>]: array([ <span class="number">3.</span> ,  <span class="number">2.5</span>,  <span class="number">2.</span> ,  <span class="number">1.5</span>], dtype=float32)</div></pre></td></tr></table></figure></li></ul><h2 id="Control-Flow"><a href="#Control-Flow" class="headerlink" title="Control Flow"></a>Control Flow</h2><h3 id="Logical-Operators"><a href="#Logical-Operators" class="headerlink" title="Logical Operators"></a>Logical Operators</h3><h4 id="tf-logical-and-tf-logical-or-tf-logical-xor-tf-logical-not"><a href="#tf-logical-and-tf-logical-or-tf-logical-xor-tf-logical-not" class="headerlink" title="tf.logical_and/tf.logical_or/tf.logical_xor/tf.logical_not"></a>tf.logical_and/tf.logical_or/tf.logical_xor/tf.logical_not</h4><ul><li>功能<br>逻辑运算符</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">logical_and(</div><div class="line">    x,</div><div class="line">    y,</div><div class="line">    name=None</div><div class="line">)</div><div class="line"></div><div class="line">Args:</div><div class="line">x: A Tensor of type bool.</div><div class="line">y: A Tensor of type bool.</div><div class="line">name: A name for the operation (optional).</div><div class="line"></div><div class="line">Returns:</div><div class="line">A Tensor of type bool.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ ipython3</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">2</span>]: t1 = tf.constant([<span class="keyword">True</span>, <span class="keyword">True</span>, <span class="keyword">False</span>, <span class="keyword">False</span>])</div><div class="line">In [<span class="number">3</span>]: t2 = tf.constant([<span class="keyword">False</span>, <span class="keyword">True</span>, <span class="keyword">False</span>, <span class="keyword">True</span>])</div><div class="line">In [<span class="number">4</span>]: <span class="keyword">with</span> tf.Session():</div><div class="line">   ...:     tf.logical_and(t1, t2).eval()</div><div class="line">   ...:     tf.logical_or(t1, t2).eval()</div><div class="line">   ...:     tf.logical_xor(t1, t2).eval()</div><div class="line">   ...:     tf.logical_not(t1).eval()</div><div class="line">Out[<span class="number">4</span>]: array([<span class="keyword">False</span>,  <span class="keyword">True</span>, <span class="keyword">False</span>, <span class="keyword">False</span>], dtype=bool)</div><div class="line">Out[<span class="number">4</span>]: array([ <span class="keyword">True</span>,  <span class="keyword">True</span>, <span class="keyword">False</span>,  <span class="keyword">True</span>], dtype=bool)</div><div class="line">Out[<span class="number">4</span>]: array([ <span class="keyword">True</span>, <span class="keyword">False</span>, <span class="keyword">False</span>,  <span class="keyword">True</span>], dtype=bool)</div><div class="line">Out[<span class="number">4</span>]: array([<span class="keyword">False</span>, <span class="keyword">False</span>,  <span class="keyword">True</span>,  <span class="keyword">True</span>], dtype=bool)</div></pre></td></tr></table></figure></li></ul><h2 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h2><h3 id="Basic-Math-Functions"><a href="#Basic-Math-Functions" class="headerlink" title="Basic Math Functions"></a>Basic Math Functions</h3><h4 id="tf-maximum"><a href="#tf-maximum" class="headerlink" title="tf.maximum"></a>tf.maximum</h4><ul><li>功能<br>取 max…</li></ul><h4 id="tf-minimum"><a href="#tf-minimum" class="headerlink" title="tf.minimum"></a>tf.minimum</h4><ul><li>功能<br>取 min…</li></ul><h2 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h2><h3 id="Splitting"><a href="#Splitting" class="headerlink" title="Splitting"></a>Splitting</h3><h4 id="tf-string-split"><a href="#tf-string-split" class="headerlink" title="tf.string_split"></a>tf.string_split</h4><ul><li>功能<br>Split elements of source based on delimiter into a SparseTensor</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">string_split(</div><div class="line">    source,</div><div class="line">    delimiter=&apos; &apos;,</div><div class="line">    skip_empty=True</div><div class="line">)</div><div class="line"></div><div class="line">Args:</div><div class="line">source: 1-D string Tensor, the strings to split.</div><div class="line">delimiter: 0-D string Tensor, the delimiter character, the string should be length 0 or 1.</div><div class="line">skip_empty: A bool. 默认值是 True 所以默认不会产生空子串</div><div class="line"></div><div class="line">Returns:</div><div class="line">A SparseTensor of rank 2, the strings split according to the delimiter. The first column of the indices corresponds to the row in source and the second column corresponds to the index of the split component in this row.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ ipython3</div><div class="line">In [<span class="number">1</span>]: load /Users/jiexiao/workspace/tmp.py</div><div class="line">In [<span class="number">2</span>]: <span class="comment"># %load /Users/jiexiao/workspace/tmp.py</span></div><div class="line">   ...:</div><div class="line">   ...: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">   ...: <span class="keyword">from</span> tensorflow.python.data <span class="keyword">import</span> Dataset</div><div class="line">   ...: <span class="function"><span class="keyword">def</span> <span class="title">print_dataset</span><span class="params">(d)</span>:</span></div><div class="line">   ...:     d_iter = d.make_one_shot_iterator()</div><div class="line">   ...:     <span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">   ...:         <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">   ...:             <span class="keyword">try</span>:</div><div class="line">   ...:                 print(sess.run(d_iter.get_next()))</div><div class="line">   ...:             <span class="keyword">except</span> tf.errors.OutOfRangeError:</div><div class="line">   ...:                 <span class="keyword">break</span></div><div class="line">In [<span class="number">3</span>]: tmp = Dataset.from_tensor_slices([<span class="string">'jie xiao'</span>, <span class="string">'huawei'</span>])</div><div class="line">In [<span class="number">4</span>]: print_dataset(tmp.map(<span class="keyword">lambda</span> x: tf.string_split([x]).values))</div><div class="line">[<span class="string">b'jie'</span> <span class="string">b'xiao'</span>]</div><div class="line">[<span class="string">b'huawei'</span>]</div></pre></td></tr></table></figure><p>可以注意到 <code>tf.string_split</code> 函数的参数至少是 1D 的 tensor，另外，<code>tf.string_split</code> 的返回值必须取 value 才能作为 Dataset 的元素，这里给出另一个例子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ ipython3</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">2</span>]: <span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">   ...:     sess.run(tf.string_split([<span class="string">'jie xiao'</span>, <span class="string">'hua wei'</span>, <span class="string">'gong zuo san nian'</span>]))</div><div class="line">Out[<span class="number">2</span>]:</div><div class="line">SparseTensorValue(indices=array([[<span class="number">0</span>, <span class="number">0</span>],</div><div class="line">       [<span class="number">0</span>, <span class="number">1</span>],</div><div class="line">       [<span class="number">1</span>, <span class="number">0</span>],</div><div class="line">       [<span class="number">1</span>, <span class="number">1</span>],</div><div class="line">       [<span class="number">2</span>, <span class="number">0</span>],</div><div class="line">       [<span class="number">2</span>, <span class="number">1</span>],</div><div class="line">       [<span class="number">2</span>, <span class="number">2</span>],</div><div class="line">       [<span class="number">2</span>, <span class="number">3</span>]]), values=array([<span class="string">b'jie'</span>, <span class="string">b'xiao'</span>, <span class="string">b'hua'</span>, <span class="string">b'wei'</span>, <span class="string">b'gong'</span>, <span class="string">b'zuo'</span>, <span class="string">b'san'</span>, <span class="string">b'nian'</span>], dtype=object), dense_shape=array([<span class="number">3</span>, <span class="number">4</span>]))</div></pre></td></tr></table></figure><p>可以看出，返回的 SparseTensorValue 对象中， values 才是我们需要的内容。<code>dense_shape</code> 表示保存切分后元素的矩阵大小，我的输入有三个元素，切分后，三个元素分别为 2、2、4 个元素，所以最终至少需要 [3, 4] 大小的矩阵保存。 indices 表示 [3, 4] 中有效信息的索引，例如，[0, 0] 对应的是输入的第一个元素被切开后的第一个子串。</p></li></ul><h2 id="Tensor-Transformations"><a href="#Tensor-Transformations" class="headerlink" title="Tensor Transformations"></a>Tensor Transformations</h2><h3 id="Casting"><a href="#Casting" class="headerlink" title="Casting"></a>Casting</h3><h4 id="tf-cast"><a href="#tf-cast" class="headerlink" title="tf.cast"></a>tf.cast</h4><ul><li>功能<br>类型转换</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">cast(</div><div class="line">    x,</div><div class="line">    dtype,</div><div class="line">    name=None</div><div class="line">)</div><div class="line"></div><div class="line">Args:</div><div class="line">x: A Tensor or SparseTensor.</div><div class="line">dtype: The destination type.</div><div class="line">name: A name for the operation (optional).</div><div class="line"></div><div class="line">Returns:</div><div class="line">A Tensor or SparseTensor with same shape as x.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ ipython3</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">2</span>]: <span class="keyword">with</span> tf.Session().as_default():</div><div class="line">   ...:     tmp = tf.constant([<span class="number">1.1</span>, <span class="number">2.8</span>], dtype=tf.float32)</div><div class="line">   ...:     tmp.eval()</div><div class="line">   ...:     tf.cast(tmp, tf.int32).eval()</div><div class="line">Out[<span class="number">2</span>]: array([ <span class="number">1.10000002</span>,  <span class="number">2.79999995</span>], dtype=float32)</div><div class="line">Out[<span class="number">2</span>]: array([<span class="number">1</span>, <span class="number">2</span>], dtype=int32)</div></pre></td></tr></table></figure></li></ul><h4 id="tf-to-int64"><a href="#tf-to-int64" class="headerlink" title="tf.to_int64"></a>tf.to_int64</h4><ul><li>功能<br>目前的理解等同于 tf.cast(x, dtype=int64)</li></ul><h3 id="Shapes-and-Shaping"><a href="#Shapes-and-Shaping" class="headerlink" title="Shapes and Shaping"></a>Shapes and Shaping</h3><h4 id="tf-reshape"><a href="#tf-reshape" class="headerlink" title="tf.reshape"></a>tf.reshape</h4><ul><li>功能<br>Reshape…</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">reshape(</div><div class="line">    tensor,</div><div class="line">    shape,</div><div class="line">    name=None</div><div class="line">)</div><div class="line"></div><div class="line">Args:</div><div class="line">tensor: A Tensor.</div><div class="line">shape: A Tensor. Must be one of the following types: int32, int64. Defines the shape of the output tensor.</div><div class="line">name: A name for the operation (optional).</div><div class="line"></div><div class="line">Returns:</div><div class="line">A Tensor. Has the same type as tensor</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ ipython3</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">2</span>]: <span class="keyword">with</span> tf.Session():</div><div class="line">   ...:     tf.reshape(tf.range(<span class="number">12</span>), [<span class="number">4</span>, <span class="number">3</span>]).eval()</div><div class="line">   ...:     tf.reshape(tf.range(<span class="number">12</span>), [<span class="number">4</span>, <span class="number">-1</span>]).eval() <span class="comment"># -1 时自动计算</span></div><div class="line">   ...:     tf.reshape(tf.range(<span class="number">1</span>), []).eval()  <span class="comment"># 向量转标量</span></div><div class="line">   ...:</div><div class="line">Out[<span class="number">2</span>]:</div><div class="line">array([[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>],</div><div class="line">       [ <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>],</div><div class="line">       [ <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>],</div><div class="line">       [ <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]], dtype=int32)</div><div class="line">Out[<span class="number">2</span>]:</div><div class="line">array([[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>],</div><div class="line">       [ <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>],</div><div class="line">       [ <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>],</div><div class="line">       [ <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]], dtype=int32)</div><div class="line">Out[<span class="number">2</span>]: <span class="number">0</span></div></pre></td></tr></table></figure></li></ul><h4 id="tf-size"><a href="#tf-size" class="headerlink" title="tf.size"></a>tf.size</h4><ul><li>功能<br>获取 tensor 中元素个数</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">size(</div><div class="line">    input,</div><div class="line">    name=None,</div><div class="line">    out_type=tf.int32</div><div class="line">)</div><div class="line"></div><div class="line">Args:</div><div class="line">input: A Tensor or SparseTensor.</div><div class="line">name: A name for the operation (optional).</div><div class="line">out_type: (Optional) The specified output type of the operation (int32 or int64). Defaults to tf.int32.</div><div class="line"></div><div class="line">Returns:</div><div class="line">A Tensor of type out_type. Defaults to tf.int32.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ ipython3</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">2</span>]: t = tf.constant([[[<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>]], [[<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>]]])</div><div class="line">In [<span class="number">3</span>]: <span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">   ...:     tf.size(t).eval()</div><div class="line">Out[<span class="number">3</span>]: <span class="number">12</span></div></pre></td></tr></table></figure></li></ul><h3 id="Slicing-and-Joining"><a href="#Slicing-and-Joining" class="headerlink" title="Slicing and Joining"></a>Slicing and Joining</h3><h4 id="tf-concat"><a href="#tf-concat" class="headerlink" title="tf.concat"></a>tf.concat</h4><ul><li>功能<br>按照某个维度连接 Tensor</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">concat(</div><div class="line">    values,</div><div class="line">    axis,</div><div class="line">    name=&apos;concat&apos;</div><div class="line">)</div><div class="line"></div><div class="line">Args:</div><div class="line">values: A list of Tensor objects or a single Tensor.</div><div class="line">axis: 0-D int32 Tensor. Dimension along which to concatenate. Must be in the range [-rank(values), rank(values)).</div><div class="line">name: A name for the operation (optional).</div><div class="line"></div><div class="line">Returns:</div><div class="line">A Tensor resulting from concatenation of the input tensors.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">$ ipython3</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">2</span>]: t1 = tf.reshape(tf.range(<span class="number">6</span>), [<span class="number">2</span>, <span class="number">3</span>]) <span class="comment"># [[0, 1, 2], [3, 4, 5]]</span></div><div class="line">In [<span class="number">3</span>]: t2 = tf.reshape(tf.range(<span class="number">6</span>, <span class="number">12</span>), [<span class="number">2</span>, <span class="number">3</span>]) <span class="comment"># [[ 6,  7,  8], [ 9, 10, 11]]</span></div><div class="line">In [<span class="number">4</span>]: <span class="keyword">with</span> tf.Session().as_default():</div><div class="line">   ...:     tf.concat([t1, t2], <span class="number">0</span>).eval()</div><div class="line">   ...:     tf.concat([t1, t2], <span class="number">1</span>).eval()</div><div class="line">Out[<span class="number">4</span>]:</div><div class="line">array([[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>],</div><div class="line">       [ <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>],</div><div class="line">       [ <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>],</div><div class="line">       [ <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]], dtype=int32)</div><div class="line">Out[<span class="number">4</span>]:</div><div class="line">array([[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>],</div><div class="line">       [ <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]], dtype=int32)</div></pre></td></tr></table></figure></li></ul><h4 id="tf-reverse"><a href="#tf-reverse" class="headerlink" title="tf.reverse"></a>tf.reverse</h4><ul><li>功能<br>翻转 tensor 的某个维度中的元素</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">reverse(</div><div class="line">    tensor,</div><div class="line">    axis,</div><div class="line">    name=None</div><div class="line">)</div><div class="line"></div><div class="line">tensor: A Tensor. Must be one of the following types: uint8, int8, uint16, int16, int32, int64, bool, half, float32, float64, complex64, complex128, string. Up to 8-D.</div><div class="line">axis:   A Tensor. Must be one of the following types: int32, int64. 1-D. The indices of the dimensions to reverse. Must be in the range [-rank(tensor), rank(tensor)).</div><div class="line">name:   A name for the operation (optional).</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">$ ipython3</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">2</span>]: tmp = tf.reshape(tf.range(<span class="number">12</span>), [<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>])</div><div class="line">In [<span class="number">3</span>]: <span class="keyword">with</span> tf.Session().as_default():</div><div class="line">   ...:     tmp.eval()</div><div class="line">   ...:     tf.reverse(tmp, [<span class="number">1</span>]).eval()</div><div class="line">   ...:     tf.reverse(tmp, [<span class="number">-1</span>]).eval()</div><div class="line">   ...:     tf.reverse(tmp, [<span class="number">3</span>]).eval()</div><div class="line">   ...:     tf.reverse(tmp, [<span class="number">1</span>, <span class="number">2</span>]).eval()</div><div class="line">Out[<span class="number">3</span>]:</div><div class="line">array([[[[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>],</div><div class="line">         [ <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>]],</div><div class="line">        [[ <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>],</div><div class="line">         [ <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]]]], dtype=int32)</div><div class="line">Out[<span class="number">3</span>]:</div><div class="line">array([[[[ <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>],</div><div class="line">         [ <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]],</div><div class="line">        [[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>],</div><div class="line">         [ <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>]]]], dtype=int32)</div><div class="line">Out[<span class="number">3</span>]:</div><div class="line">array([[[[ <span class="number">2</span>,  <span class="number">1</span>,  <span class="number">0</span>],</div><div class="line">         [ <span class="number">5</span>,  <span class="number">4</span>,  <span class="number">3</span>]],</div><div class="line">        [[ <span class="number">8</span>,  <span class="number">7</span>,  <span class="number">6</span>],</div><div class="line">         [<span class="number">11</span>, <span class="number">10</span>,  <span class="number">9</span>]]]], dtype=int32)</div><div class="line">Out[<span class="number">3</span>]:</div><div class="line">array([[[[ <span class="number">2</span>,  <span class="number">1</span>,  <span class="number">0</span>],</div><div class="line">         [ <span class="number">5</span>,  <span class="number">4</span>,  <span class="number">3</span>]],</div><div class="line">        [[ <span class="number">8</span>,  <span class="number">7</span>,  <span class="number">6</span>],</div><div class="line">         [<span class="number">11</span>, <span class="number">10</span>,  <span class="number">9</span>]]]], dtype=int32)</div><div class="line">Out[<span class="number">3</span>]:</div><div class="line">array([[[[ <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>],</div><div class="line">         [ <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>]],</div><div class="line">        [[ <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>],</div><div class="line">         [ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>]]]], dtype=int32)</div></pre></td></tr></table></figure></li></ul><h2 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h2><h3 id="Sharing-Variables"><a href="#Sharing-Variables" class="headerlink" title="Sharing Variables"></a>Sharing Variables</h3><h4 id="tf-random-uniform-initializer"><a href="#tf-random-uniform-initializer" class="headerlink" title="tf.random_uniform_initializer"></a>tf.random_uniform_initializer</h4><ul><li>功能<br>变量初始化的值符合均匀分布</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">__init__(</div><div class="line">    minval=0,</div><div class="line">    maxval=None,</div><div class="line">    seed=None,</div><div class="line">    dtype=tf.float32</div><div class="line">)</div><div class="line"></div><div class="line">Args:</div><div class="line"></div><div class="line">minval: A python scalar or a scalar tensor. Lower bound of the range of random values to generate.</div><div class="line">maxval: A python scalar or a scalar tensor. Upper bound of the range of random values to generate. Defaults to 1 for float types.</div><div class="line">seed: A Python integer. Used to create random seeds. See tf.set_random_seed for behavior.</div><div class="line">dtype: The data type.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ ipython3</div><div class="line">In [1]: import tensorflow as tf</div><div class="line">In [2]: import matplotlib.pyplot as plt</div><div class="line">In [3]: a1 = tf.get_variable(name=&apos;a1&apos;, shape=[2000], initializer=tf.random_uniform_initializer(-1, 1))</div><div class="line">In [4]: sess = tf.Session()</div><div class="line">In [5]: sess.run(tf.global_variables_initializer())</div><div class="line">In [6]: tmp = sess.run(a1)</div><div class="line">In [7]: plt.hist(tmp, 100)</div><div class="line">In [8]: plt.show()</div></pre></td></tr></table></figure></li></ul><p><img src="/images/tensorflow_api/random_uniform_initializer.png" alt="tf.random_uniform_initializer"></p><h4 id="tf-VariableScope"><a href="#tf-VariableScope" class="headerlink" title="tf.VariableScope"></a>tf.VariableScope</h4><h5 id="set-initializer"><a href="#set-initializer" class="headerlink" title="set_initializer"></a>set_initializer</h5><ul><li>功能<br>设置当前 scope 下的变量初始化函数，</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">set_initializer(initializer)</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">$ ipython3</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line">In [<span class="number">2</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">3</span>]: <span class="keyword">with</span> tf.variable_scope(<span class="string">'my'</span>):</div><div class="line">   ...:     a1 = tf.get_variable(name=<span class="string">'a1'</span>, shape=[<span class="number">1000</span>])</div><div class="line">   ...:     tf.get_variable_scope().set_initializer(tf.keras.initializers.glorot_normal())</div><div class="line">   ...:     a2 = tf.get_variable(name=<span class="string">'a2'</span>, shape=[<span class="number">1000</span>])</div><div class="line">In [<span class="number">4</span>]: a3 = tf.get_variable(name=<span class="string">'a3'</span>, shape=[<span class="number">1000</span>])</div><div class="line">In [<span class="number">5</span>]: sess = tf.Session()</div><div class="line">In [<span class="number">6</span>]: sess.run(tf.global_variables_initializer())</div><div class="line">In [<span class="number">7</span>]: tmp1, tmp2, tmp3 = sess.run([a1, a2, a3])</div><div class="line">In [<span class="number">8</span>]: plt.hist(tmp1) <span class="comment"># 可以看出初始化的值并不符合正态分布，所以 set_initializer 必须在变量定义前执行</span></div><div class="line">Out[<span class="number">8</span>]:</div><div class="line">(array([  <span class="number">99.</span>,   <span class="number">85.</span>,   <span class="number">95.</span>,  <span class="number">109.</span>,   <span class="number">86.</span>,  <span class="number">103.</span>,  <span class="number">101.</span>,  <span class="number">111.</span>,  <span class="number">101.</span>,  <span class="number">110.</span>]),</div><div class="line"> array([ <span class="number">-5.47123924e-02</span>,  <span class="number">-4.37659476e-02</span>,  <span class="number">-3.28195028e-02</span>,</div><div class="line">         <span class="number">-2.18730580e-02</span>,  <span class="number">-1.09266132e-02</span>,   <span class="number">1.98315829e-05</span>,</div><div class="line">          <span class="number">1.09662764e-02</span>,   <span class="number">2.19127212e-02</span>,   <span class="number">3.28591660e-02</span>,</div><div class="line">          <span class="number">4.38056108e-02</span>,   <span class="number">5.47520556e-02</span>]),</div><div class="line"> &lt;a list of <span class="number">10</span> Patch objects&gt;)</div><div class="line">In [<span class="number">9</span>]: plt.show()</div><div class="line">In [<span class="number">10</span>]: plt.hist(tmp2) <span class="comment"># 这里就对了</span></div><div class="line">Out[<span class="number">10</span>]:</div><div class="line">Out[<span class="number">10</span>]:</div><div class="line">(array([  <span class="number">33.</span>,   <span class="number">61.</span>,   <span class="number">99.</span>,  <span class="number">157.</span>,  <span class="number">168.</span>,  <span class="number">160.</span>,  <span class="number">132.</span>,  <span class="number">103.</span>,   <span class="number">61.</span>,   <span class="number">26.</span>]),</div><div class="line"> array([<span class="number">-0.0629639</span> , <span class="number">-0.05034959</span>, <span class="number">-0.03773528</span>, <span class="number">-0.02512098</span>, <span class="number">-0.01250667</span>,</div><div class="line">         <span class="number">0.00010763</span>,  <span class="number">0.01272194</span>,  <span class="number">0.02533624</span>,  <span class="number">0.03795055</span>,  <span class="number">0.05056485</span>,</div><div class="line">         <span class="number">0.06317916</span>]),</div><div class="line"> &lt;a list of <span class="number">10</span> Patch objects&gt;)</div><div class="line">In [<span class="number">11</span>]: plt.show()</div><div class="line">In [<span class="number">12</span>]: plt.hist(tmp3) <span class="comment"># 这里已经不属于同一个 scope 了，所以分布也不符合正态分布</span></div><div class="line">Out[<span class="number">12</span>]:</div><div class="line">(array([  <span class="number">98.</span>,  <span class="number">109.</span>,   <span class="number">81.</span>,  <span class="number">112.</span>,   <span class="number">69.</span>,   <span class="number">92.</span>,   <span class="number">97.</span>,  <span class="number">110.</span>,  <span class="number">118.</span>,  <span class="number">114.</span>]),</div><div class="line"> array([<span class="number">-0.0544718</span> , <span class="number">-0.04354969</span>, <span class="number">-0.03262758</span>, <span class="number">-0.02170548</span>, <span class="number">-0.01078337</span>,</div><div class="line">         <span class="number">0.00013874</span>,  <span class="number">0.01106084</span>,  <span class="number">0.02198295</span>,  <span class="number">0.03290506</span>,  <span class="number">0.04382716</span>,</div><div class="line">         <span class="number">0.05474927</span>]),</div><div class="line"> &lt;a list of <span class="number">10</span> Patch objects&gt;)</div><div class="line">In [<span class="number">13</span>]: plt.show()</div></pre></td></tr></table></figure></li></ul><h1 id="tf-data"><a href="#tf-data" class="headerlink" title="tf.data"></a>tf.data</h1><h2 id="tf-data-Dataset"><a href="#tf-data-Dataset" class="headerlink" title="tf.data.Dataset"></a>tf.data.Dataset</h2><h3 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h3><ul><li>功能<br>对 Dataset 的元素使用一个转换函数，转换函数目前多定义于 <code>tf.contrib.data</code></li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">apply(transformation_func)</div><div class="line"></div><div class="line">Args:</div><div class="line">transformation_func: A function that takes one Dataset argument and returns a Dataset.</div><div class="line"></div><div class="line">Returns:</div><div class="line">The Dataset returned by applying transformation_func to this dataset.</div></pre></td></tr></table></figure></li><li><p>示例<br>参考 <code>tf.contrib.data.group_by_window</code></p></li></ul><h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><ul><li>功能<br>过滤…</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">filter(predicate)</div><div class="line"></div><div class="line">Args:</div><div class="line">predicate: A function mapping a nested structure of tensors (having shapes and types defined by self.output_shapes and self.output_types) to a scalar tf.bool tensor.</div><div class="line"></div><div class="line">Returns:</div><div class="line">A Dataset.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">$ ipython3</div><div class="line">In [<span class="number">1</span>]: load /Users/jiexiao/workspace/tmp.py</div><div class="line">In [<span class="number">2</span>]: <span class="comment"># %load /Users/jiexiao/workspace/tmp.py</span></div><div class="line">   ...: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">   ...: <span class="keyword">from</span> tensorflow.python.data <span class="keyword">import</span> Dataset</div><div class="line">   ...: <span class="function"><span class="keyword">def</span> <span class="title">print_dataset</span><span class="params">(d)</span>:</span></div><div class="line">   ...:     d_iter = d.make_one_shot_iterator()</div><div class="line">   ...:     <span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">   ...:         <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">   ...:             <span class="keyword">try</span>:</div><div class="line">   ...:                 print(sess.run(d_iter.get_next()))</div><div class="line">   ...:             <span class="keyword">except</span> tf.errors.OutOfRangeError:</div><div class="line">   ...:                 <span class="keyword">break</span></div><div class="line">In [<span class="number">3</span>]: a = Dataset.range(<span class="number">11</span>)</div><div class="line">In [<span class="number">4</span>]: print_dataset(a.filter(<span class="keyword">lambda</span> x: x &gt; <span class="number">6</span>))</div><div class="line"><span class="number">7</span></div><div class="line"><span class="number">8</span></div><div class="line"><span class="number">9</span></div><div class="line"><span class="number">10</span></div></pre></td></tr></table></figure></li></ul><h3 id="make-initializable-iterator"><a href="#make-initializable-iterator" class="headerlink" title="make_initializable_iterator"></a>make_initializable_iterator</h3><ul><li>功能<br>创建一个 Dataset 的迭代器，可以对比 make_one_shot_iterator</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">make_initializable_iterator(shared_name=None)</div><div class="line"></div><div class="line">Args:</div><div class="line">shared_name: (Optional.) If non-empty, the returned iterator will be shared under the given name across multiple sessions that share the same devices (e.g. when using a remote server).</div><div class="line"></div><div class="line">Returns:</div><div class="line">An Iterator over the elements of this dataset.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ ipython</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> tensorflow.python.data <span class="keyword">import</span> Dataset</div><div class="line">In [<span class="number">2</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">3</span>]: dataset = Dataset.range(<span class="number">5</span>)</div><div class="line">In [<span class="number">4</span>]: d_iter = dataset.make_initializable_iterator()</div><div class="line">In [<span class="number">5</span>]: <span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">   ...:     sess.run(d_iter.initializer)</div><div class="line">   ...:     print(d_iter.get_next().eval())</div><div class="line">   ...:     sess.run(d_iter.initializer)</div><div class="line">   ...:     print(d_iter.get_next().eval())</div><div class="line">   ...:</div><div class="line"><span class="number">0</span></div><div class="line"><span class="number">0</span></div></pre></td></tr></table></figure></li></ul><h3 id="make-one-shot-iterator"><a href="#make-one-shot-iterator" class="headerlink" title="make_one_shot_iterator"></a>make_one_shot_iterator</h3><ul><li>功能<br>创建一个 Dataset 的迭代器，可以对比 make_initializable_iterator, 主要区别是：返回的迭代器不能调用 initializer，所以只能遍历一次</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make_one_shot_iterator()</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ ipython</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> tensorflow.python.data <span class="keyword">import</span> Dataset</div><div class="line">In [<span class="number">2</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">3</span>]: dataset = Dataset.range(<span class="number">5</span>)</div><div class="line">In [<span class="number">4</span>]: d_iter = dataset.make_one_shot_iterator()</div><div class="line">In [<span class="number">5</span>]: <span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">   ...:     print(d_iter.get_next().eval())</div><div class="line">   ...:     print(d_iter.get_next().eval())</div><div class="line"><span class="number">0</span></div><div class="line"><span class="number">1</span></div></pre></td></tr></table></figure></li></ul><h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><ul><li>功能<br>对 Dataset 中的所有元素执行指定函数</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">map(</div><div class="line">    map_func,</div><div class="line">    num_parallel_calls=None</div><div class="line">)</div><div class="line"></div><div class="line">Args:</div><div class="line">map_func: A function mapping a nested structure of tensors (having shapes and types defined by self.output_shapes and self.output_types) to another nested structure of tensors.</div><div class="line">num_parallel_calls: (Optional.) A tf.int32 scalar tf.Tensor, representing the number elements to process in parallel. If not specified, elements will be processed sequentially.</div><div class="line"></div><div class="line">Returns:</div><div class="line">A Dataset.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ ipython3</div><div class="line">In [<span class="number">1</span>]: load /Users/jiexiao/workspace/tmp.py</div><div class="line">In [<span class="number">2</span>]: <span class="comment"># %load /Users/jiexiao/workspace/tmp.py</span></div><div class="line">   ...: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">   ...: <span class="keyword">from</span> tensorflow.python.data <span class="keyword">import</span> Dataset</div><div class="line">   ...: <span class="function"><span class="keyword">def</span> <span class="title">print_dataset</span><span class="params">(d)</span>:</span></div><div class="line">   ...:     d_iter = d.make_one_shot_iterator()</div><div class="line">   ...:     <span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">   ...:         <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">   ...:             <span class="keyword">try</span>:</div><div class="line">   ...:                 print(sess.run(d_iter.get_next()))</div><div class="line">   ...:             <span class="keyword">except</span> tf.errors.OutOfRangeError:</div><div class="line">   ...:                 <span class="keyword">break</span></div><div class="line">   ...: a = Dataset.range(<span class="number">1</span>, <span class="number">4</span>) <span class="comment"># &#123;1, 2, 3&#125;</span></div><div class="line">In [<span class="number">3</span>]: print_dataset(a.map(<span class="keyword">lambda</span> x: x * <span class="number">2</span>))</div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">4</span></div><div class="line"><span class="number">6</span></div></pre></td></tr></table></figure></li></ul><h3 id="padded-batch"><a href="#padded-batch" class="headerlink" title="padded_batch"></a>padded_batch</h3><ul><li>功能<br>将 Dataset 分为固定大小的 <code>batch_size</code>, 同时将每个 batch 进行 padding，padding 长度默认为当前 batch 中的最大值</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">padded_batch(</div><div class="line">    batch_size,</div><div class="line">    padded_shapes,</div><div class="line">    padding_values=None</div><div class="line">)</div><div class="line"></div><div class="line">Args:</div><div class="line">batch_size:     A tf.int64 scalar tf.Tensor, 每个 batch 的大小</div><div class="line">padded_shapes:  Dataset 中每个数据的 shape，如果出现 tf.TensorShape([None]) 则表示 padding 至当前 batch 中的最大值</div><div class="line">padding_values: (Optional.)  padding 的值，默认为 0 或者 &apos;&apos;</div><div class="line"></div><div class="line">Returns:</div><div class="line">A Dataset.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">$ ipython</div><div class="line">In [<span class="number">1</span>]: load /root/workspace/tmp.py</div><div class="line">In [<span class="number">2</span>]: <span class="comment"># %load /root/workspace/tmp.py</span></div><div class="line">   ...: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">   ...: <span class="keyword">from</span> tensorflow.python.data <span class="keyword">import</span> Dataset</div><div class="line">   ...: <span class="function"><span class="keyword">def</span> <span class="title">print_dataset</span><span class="params">(d)</span>:</span></div><div class="line">   ...:     d_iter = d.make_one_shot_iterator()</div><div class="line">   ...:     <span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">   ...:         <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">   ...:             <span class="keyword">try</span>:</div><div class="line">   ...:                 print(sess.run(d_iter.get_next()))</div><div class="line">   ...:             <span class="keyword">except</span> tf.errors.OutOfRangeError:</div><div class="line">   ...:                 <span class="keyword">break</span></div><div class="line">In [<span class="number">3</span>]: dataset = tf.data.Dataset.range(<span class="number">10</span>)</div><div class="line">In [<span class="number">4</span>]: dataset = dataset.map(<span class="keyword">lambda</span> x: &#123;<span class="string">'x'</span>: tf.fill([tf.cast(x, tf.int32)], x), <span class="string">'y'</span>: tf.fill([tf.cast(x, tf.int32)], x)&#125;)</div><div class="line">In [<span class="number">5</span>]: print_dataset(dataset) <span class="comment"># 这里有 10 个元素，且每个元素包含的子项不一样多</span></div><div class="line">&#123;<span class="string">'x'</span>: array([], dtype=int64), <span class="string">'y'</span>: array([], dtype=int64)&#125;</div><div class="line">&#123;<span class="string">'x'</span>: array([<span class="number">1</span>]), <span class="string">'y'</span>: array([<span class="number">1</span>])&#125;</div><div class="line">&#123;<span class="string">'x'</span>: array([<span class="number">2</span>, <span class="number">2</span>]), <span class="string">'y'</span>: array([<span class="number">2</span>, <span class="number">2</span>])&#125;</div><div class="line">&#123;<span class="string">'x'</span>: array([<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>]), <span class="string">'y'</span>: array([<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>])&#125;</div><div class="line">&#123;<span class="string">'x'</span>: array([<span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>]), <span class="string">'y'</span>: array([<span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>])&#125;</div><div class="line">&#123;<span class="string">'x'</span>: array([<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>]), <span class="string">'y'</span>: array([<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>])&#125;</div><div class="line">&#123;<span class="string">'x'</span>: array([<span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>]), <span class="string">'y'</span>: array([<span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>])&#125;</div><div class="line">&#123;<span class="string">'x'</span>: array([<span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>]), <span class="string">'y'</span>: array([<span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>])&#125;</div><div class="line">&#123;<span class="string">'x'</span>: array([<span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>]), <span class="string">'y'</span>: array([<span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>])&#125;</div><div class="line">&#123;<span class="string">'x'</span>: array([<span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>]), <span class="string">'y'</span>: array([<span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>])&#125;</div><div class="line">In [<span class="number">6</span>]: dataset = dataset.padded_batch(<span class="number">4</span>, padded_shapes=&#123;<span class="string">'x'</span>: [<span class="keyword">None</span>], <span class="string">'y'</span>: [<span class="keyword">None</span>]&#125;)</div><div class="line">In [<span class="number">7</span>]: print_dataset(dataset) <span class="comment"># 这里只剩下 3 个 batch 了，每个 batch 中的元素的子项数量是一致的，都是当前 batch 中的最大值</span></div><div class="line">&#123;<span class="string">'x'</span>: array([[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</div><div class="line">       [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</div><div class="line">       [<span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],</div><div class="line">       [<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>]]), <span class="string">'y'</span>: array([[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</div><div class="line">       [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</div><div class="line">       [<span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],</div><div class="line">       [<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>]])&#125;</div><div class="line">&#123;<span class="string">'x'</span>: array([[<span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</div><div class="line">       [<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>],</div><div class="line">       [<span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">0</span>],</div><div class="line">       [<span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>]]), <span class="string">'y'</span>: array([[<span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</div><div class="line">       [<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>],</div><div class="line">       [<span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">0</span>],</div><div class="line">       [<span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>]])&#125;</div><div class="line">&#123;<span class="string">'x'</span>: array([[<span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">0</span>],</div><div class="line">       [<span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>]]), <span class="string">'y'</span>: array([[<span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">0</span>],</div><div class="line">       [<span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>]])&#125;</div></pre></td></tr></table></figure></li></ul><h3 id="prefetch"><a href="#prefetch" class="headerlink" title="prefetch"></a>prefetch</h3><ul><li>功能<br>个人感觉就是为了在性能和占用内存间选一个合适的界限</li><li>描述<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">prefetch(buffer_size)</div><div class="line"></div><div class="line">Args:</div><div class="line">buffer_size: A tf.int64 scalar tf.Tensor, representing the maximum number elements that will be buffered when prefetching.</div><div class="line"></div><div class="line">Returns:</div><div class="line">A Dataset.</div></pre></td></tr></table></figure></li></ul><h3 id="shard"><a href="#shard" class="headerlink" title="shard"></a>shard</h3><ul><li>功能<br>将一个 Dataset 切分成 N 份，然后取出 1 份，在分布式训练时，避免资源竞争使用</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">shard(</div><div class="line">    num_shards,</div><div class="line">    index</div><div class="line">)</div><div class="line"></div><div class="line">Args:</div><div class="line">num_shards: A tf.int64 scalar tf.Tensor, 切分的份数</div><div class="line">index:      A tf.int64 scalar tf.Tensor, 取出份数的 ID</div><div class="line"></div><div class="line">Returns:</div><div class="line">A Dataset.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">$ ipython</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">2</span>]: <span class="keyword">from</span> tensorflow.python.data <span class="keyword">import</span> Dataset</div><div class="line">In [<span class="number">3</span>]: <span class="function"><span class="keyword">def</span> <span class="title">print_dataset</span><span class="params">(d)</span>:</span></div><div class="line">   ...:     d_iter = d.make_one_shot_iterator()</div><div class="line">   ...:     <span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">   ...:         <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">   ...:             <span class="keyword">try</span>:</div><div class="line">   ...:                 print(sess.run(d_iter.get_next()))</div><div class="line">   ...:             <span class="keyword">except</span> tf.errors.OutOfRangeError:</div><div class="line">   ...:                 <span class="keyword">break</span></div><div class="line">In [<span class="number">4</span>]: a = Dataset.range(<span class="number">1</span>, <span class="number">4</span>) <span class="comment"># &#123;1, 2, 3&#125;</span></div><div class="line">In [<span class="number">5</span>]: print_dataset(a.shard(<span class="number">2</span>, <span class="number">0</span>))</div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">3</span></div><div class="line">In [<span class="number">6</span>]: print_dataset(a.shard(<span class="number">2</span>, <span class="number">1</span>))</div><div class="line"><span class="number">2</span></div></pre></td></tr></table></figure></li></ul><h3 id="shuffle"><a href="#shuffle" class="headerlink" title="shuffle"></a>shuffle</h3><ul><li>功能<br>对 Dataset 中的数据进行重新排序</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">shuffle(</div><div class="line">    buffer_size,</div><div class="line">    seed=None,</div><div class="line">    reshuffle_each_iteration=None</div><div class="line">)</div><div class="line"></div><div class="line">Args:</div><div class="line">buffer_size:              A tf.int64 scalar tf.Tensor, 目前的理解是用于内存管理，控制每次加载到内存中的元素个数</div><div class="line">seed:                     (Optional.) A tf.int64 scalar tf.Tensor, representing the random seed that will be used to create the distribution. See tf.set_random_seed for behavior.</div><div class="line">reshuffle_each_iteration: (Optional.) A boolean, which if true indicates that the dataset should be pseudorandomly reshuffled each time it is iterated over. (Defaults to True.)</div><div class="line"></div><div class="line">Returns:</div><div class="line">A Dataset.</div></pre></td></tr></table></figure><p><a href="https://stackoverflow.com/questions/45124719/memory-management-in-tensorflows-dataset-api" target="_blank" rel="external">buffer_size 使用场景</a><br><a href="https://stackoverflow.com/questions/46444018/meaning-of-buffer-size-in-dataset-map-dataset-prefetch-and-dataset-shuffle" target="_blank" rel="external">buffer_size 理解</a></p></li><li>示例<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">$ ipython3</div><div class="line">Python <span class="number">3.6</span><span class="number">.1</span> (default, Apr  <span class="number">4</span> <span class="number">2017</span>, <span class="number">09</span>:<span class="number">40</span>:<span class="number">21</span>)</div><div class="line">Type <span class="string">'copyright'</span>, <span class="string">'credits'</span> <span class="keyword">or</span> <span class="string">'license'</span> <span class="keyword">for</span> more information</div><div class="line">IPython <span class="number">6.1</span><span class="number">.0</span> -- An enhanced Interactive Python. Type <span class="string">'?'</span> <span class="keyword">for</span> help.</div><div class="line">In [<span class="number">1</span>]: load /Users/jiexiao/workspace/tmp.py</div><div class="line">In [<span class="number">2</span>]: <span class="comment"># %load /Users/jiexiao/workspace/tmp.py</span></div><div class="line">   ...: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">   ...: <span class="keyword">from</span> tensorflow.python.data <span class="keyword">import</span> Dataset</div><div class="line">   ...: <span class="function"><span class="keyword">def</span> <span class="title">print_dataset</span><span class="params">(d)</span>:</span></div><div class="line">   ...:     d_iter = d.make_one_shot_iterator()</div><div class="line">   ...:     <span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">   ...:         <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">   ...:             <span class="keyword">try</span>:</div><div class="line">   ...:                 print(sess.run(d_iter.get_next()))</div><div class="line">   ...:             <span class="keyword">except</span> tf.errors.OutOfRangeError:</div><div class="line">   ...:                 <span class="keyword">break</span></div><div class="line">   ...: a = Dataset.range(<span class="number">1</span>, <span class="number">4</span>) <span class="comment"># &#123;1, 2, 3&#125;</span></div><div class="line">In [<span class="number">3</span>]: print_dataset(a.shuffle(<span class="number">10</span>))</div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">3</span></div></pre></td></tr></table></figure></li></ul><h3 id="skip"><a href="#skip" class="headerlink" title="skip"></a>skip</h3><ul><li>功能<br>丢弃一部分数据</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">skip(count)</div><div class="line"></div><div class="line">Args:</div><div class="line">count: A tf.int64 scalar tf.Tensor, representing the number of elements of this dataset that should be skipped to form the new dataset. If count is greater than the size of this dataset, the new dataset will contain no elements. If count is -1, skips the entire dataset.</div><div class="line"></div><div class="line">Returns:</div><div class="line">A Dataset.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">$ ipython</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">2</span>]: <span class="keyword">from</span> tensorflow.python.data <span class="keyword">import</span> Dataset</div><div class="line">In [<span class="number">3</span>]: <span class="function"><span class="keyword">def</span> <span class="title">print_dataset</span><span class="params">(d)</span>:</span></div><div class="line">   ...:     d_iter = d.make_one_shot_iterator()</div><div class="line">   ...:     <span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">   ...:         <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">   ...:             <span class="keyword">try</span>:</div><div class="line">   ...:                 print(sess.run(d_iter.get_next()))</div><div class="line">   ...:             <span class="keyword">except</span> tf.errors.OutOfRangeError:</div><div class="line">   ...:                 <span class="keyword">break</span></div><div class="line">In [<span class="number">4</span>]: a = Dataset.range(<span class="number">1</span>, <span class="number">4</span>) <span class="comment"># &#123;1, 2, 3&#125;</span></div><div class="line">In [<span class="number">5</span>]: print_dataset(a.skip(<span class="number">1</span>))</div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">3</span></div><div class="line">In [<span class="number">6</span>]: print_dataset(a.skip(<span class="number">2</span>))</div><div class="line"><span class="number">3</span></div></pre></td></tr></table></figure></li></ul><h3 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h3><ul><li>功能<br>与 python 内置的 zip 类似</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">zip(datasets)</div><div class="line"></div><div class="line">Args:</div><div class="line">datasets: A nested structure of datasets.</div><div class="line"></div><div class="line">Returns:</div><div class="line">A Dataset.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">$ ipython</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> tensorflow.python.data <span class="keyword">import</span> Dataset</div><div class="line">In [<span class="number">2</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">3</span>]: <span class="function"><span class="keyword">def</span> <span class="title">print_dataset</span><span class="params">(d)</span>:</span></div><div class="line">   ...:     d_iter = d.make_one_shot_iterator()</div><div class="line">   ...:     <span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">   ...:         <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">   ...:             <span class="keyword">try</span>:</div><div class="line">   ...:                 print(sess.run(d_iter.get_next()))</div><div class="line">   ...:             <span class="keyword">except</span> tf.errors.OutOfRangeError:</div><div class="line">   ...:                 <span class="keyword">break</span></div><div class="line">   ...:</div><div class="line">In [<span class="number">4</span>]: a = Dataset.range(<span class="number">1</span>, <span class="number">4</span>) <span class="comment"># &#123;1, 2, 3&#125;</span></div><div class="line">In [<span class="number">5</span>]: b = Dataset.range(<span class="number">4</span>, <span class="number">7</span>) <span class="comment"># &#123;4, 5, 6&#125;</span></div><div class="line">In [<span class="number">7</span>]: c = Dataset.zip((Dataset.range(<span class="number">7</span>, <span class="number">12</span>), Dataset.range(<span class="number">8</span>, <span class="number">13</span>))) <span class="comment"># &#123; (7, 8), (8, 9), (9, 10) &#125;</span></div><div class="line">In [<span class="number">8</span>]: d = Dataset.range(<span class="number">13</span>, <span class="number">15</span>) <span class="comment"># &#123;13, 14&#125;</span></div><div class="line">In [<span class="number">9</span>]: print_dataset(Dataset.zip((a, b)))</div><div class="line">(<span class="number">1</span>, <span class="number">4</span>)</div><div class="line">(<span class="number">2</span>, <span class="number">5</span>)</div><div class="line">(<span class="number">3</span>, <span class="number">6</span>)</div><div class="line">In [<span class="number">10</span>]: print_dataset(Dataset.zip((b, a)))</div><div class="line">(<span class="number">4</span>, <span class="number">1</span>)</div><div class="line">(<span class="number">5</span>, <span class="number">2</span>)</div><div class="line">(<span class="number">6</span>, <span class="number">3</span>)</div><div class="line">In [<span class="number">11</span>]: print_dataset(Dataset.zip((a, b, c)))</div><div class="line">(<span class="number">1</span>, <span class="number">4</span>, (<span class="number">7</span>, <span class="number">8</span>))</div><div class="line">(<span class="number">2</span>, <span class="number">5</span>, (<span class="number">8</span>, <span class="number">9</span>))</div><div class="line">(<span class="number">3</span>, <span class="number">6</span>, (<span class="number">9</span>, <span class="number">10</span>))</div><div class="line">In [<span class="number">12</span>]: print_dataset(Dataset.zip((a, d)))</div><div class="line">(<span class="number">1</span>, <span class="number">13</span>)</div><div class="line">(<span class="number">2</span>, <span class="number">14</span>)</div></pre></td></tr></table></figure></li></ul><h2 id="tf-data-Iterator"><a href="#tf-data-Iterator" class="headerlink" title="tf.data.Iterator"></a>tf.data.Iterator</h2><h3 id="get-next"><a href="#get-next" class="headerlink" title="get_next"></a>get_next</h3><ul><li>功能<br>通过 Iterator 从 Dataset 中取数据</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">get_next(name=None)</div><div class="line"></div><div class="line">Args:</div><div class="line">name: (Optional.) A name for the created operation.</div><div class="line"></div><div class="line">Returns:</div><div class="line">A nested structure of tf.Tensor objects.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ ipython</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> tensorflow.python.data <span class="keyword">import</span> Dataset</div><div class="line">In [<span class="number">2</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">3</span>]: dataset = Dataset.range(<span class="number">5</span>)</div><div class="line">In [<span class="number">4</span>]: d_iter = dataset.make_one_shot_iterator()</div><div class="line">In [<span class="number">5</span>]: <span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">   ...:     print(d_iter.get_next().eval())</div><div class="line">   ...:     print(d_iter.get_next().eval())</div><div class="line"><span class="number">0</span></div><div class="line"><span class="number">1</span></div></pre></td></tr></table></figure></li></ul><h2 id="tf-data-TextLineDataset"><a href="#tf-data-TextLineDataset" class="headerlink" title="tf.data.TextLineDataset"></a>tf.data.TextLineDataset</h2><ul><li>功能<br>按行读取文件，转化为 TextLineDataset 对象</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">__init__(</div><div class="line">    filenames,</div><div class="line">    compression_type=None,</div><div class="line">    buffer_size=None</div><div class="line">)</div><div class="line"></div><div class="line">Args:</div><div class="line">filenames:        A tf.string tensor containing one or more filenames.</div><div class="line">compression_type: (Optional.) A tf.string scalar evaluating to one of &quot;&quot; (no compression), &quot;ZLIB&quot;, or &quot;GZIP&quot;.</div><div class="line">buffer_size:      (Optional.) A tf.int64 scalar denoting the number of bytes to buffer. A value of 0 results in the default buffering values chosen based on the compression type.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">$ cat /tmp/test.txt</div><div class="line">emerson</div><div class="line">lake</div><div class="line">palmer</div><div class="line"></div><div class="line">$ ipython</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> tensorflow.python.data <span class="keyword">import</span> TextLineDataset</div><div class="line">In [<span class="number">2</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">3</span>]: <span class="function"><span class="keyword">def</span> <span class="title">print_dataset</span><span class="params">(d)</span>:</span></div><div class="line">   ...:     d_iter = d.make_one_shot_iterator()</div><div class="line">   ...:     <span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">   ...:         <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">   ...:             <span class="keyword">try</span>:</div><div class="line">   ...:                 print(sess.run(d_iter.get_next()))</div><div class="line">   ...:             <span class="keyword">except</span> tf.errors.OutOfRangeError:</div><div class="line">   ...:                 <span class="keyword">break</span></div><div class="line">In [<span class="number">4</span>]: tmp = tf.data.TextLineDataset(<span class="string">'/tmp/test.txt'</span>)</div><div class="line">In [<span class="number">5</span>]: print_dataset(tmp)</div><div class="line"><span class="string">b'emerson'</span></div><div class="line"><span class="string">b'lake'</span></div><div class="line"><span class="string">b'palmer'</span></div></pre></td></tr></table></figure></li></ul><h1 id="tf-contrib-data"><a href="#tf-contrib-data" class="headerlink" title="tf.contrib.data"></a>tf.contrib.data</h1><h2 id="tf-contrib-data-group-by-window"><a href="#tf-contrib-data-group-by-window" class="headerlink" title="tf.contrib.data.group_by_window"></a>tf.contrib.data.group_by_window</h2><ul><li>功能<br>将训练数据划分为多组，然后对每组数据进行 padding、shuffle、batch 等操作</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">group_by_window(</div><div class="line">    key_func,</div><div class="line">    reduce_func,</div><div class="line">    window_size=None,</div><div class="line">    window_size_func=None</div><div class="line">)</div><div class="line"></div><div class="line">Args:</div><div class="line">key_func: 将 Tensor 映射为一个 ID。典型场景：根据训练数据的输入输出长度，产生一个合适的 bucket id。</div><div class="line">reduce_func: 从 Dataset 中取出 window_size 个元素，然后对这些元素进行 padding、shuffle、batch 等操作</div><div class="line">window_size: 表示 window_size, 作为 reduce_func 的第一个参数传入，与 window_size_func 互斥</div><div class="line">window_size_func: 通过 key_func 计算的 ID 来计算 window_size, 与 window_size 参数互斥</div><div class="line"></div><div class="line">Returns:</div><div class="line">A Dataset transformation function, which can be passed to tf.data.Dataset.apply.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">$ ipython</div><div class="line">In [<span class="number">1</span>]: load /root/workspace/tmp.py</div><div class="line">In [<span class="number">2</span>]: <span class="comment"># %load /root/workspace/tmp.py</span></div><div class="line">   ...: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">   ...: <span class="keyword">from</span> tensorflow.python.data <span class="keyword">import</span> Dataset</div><div class="line">   ...: <span class="function"><span class="keyword">def</span> <span class="title">print_dataset</span><span class="params">(d)</span>:</span></div><div class="line">   ...:     d_iter = d.make_one_shot_iterator()</div><div class="line">   ...:     <span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">   ...:         <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">   ...:             <span class="keyword">try</span>:</div><div class="line">   ...:                 print(sess.run(d_iter.get_next()))</div><div class="line">   ...:             <span class="keyword">except</span> tf.errors.OutOfRangeError:</div><div class="line">   ...:                 <span class="keyword">break</span></div><div class="line">In [<span class="number">3</span>]: dataset = Dataset.range(<span class="number">12</span>)</div><div class="line">In [<span class="number">4</span>]: dataset = dataset.apply(tf.contrib.data.group_by_window(key_func=<span class="keyword">lambda</span> x: x%<span class="number">2</span>, reduce_func=<span class="keyword">lambda</span> x, els: els.batch(<span class="number">3</span>), window_size=<span class="number">3</span>))</div><div class="line">In [<span class="number">5</span>]: print_dataset(dataset) <span class="comment"># 这里 window_size 为 3，所以首先从双数数列取了 3 个元素，划分为 1 个大小为 3 的  batch，然后从单数数列取了 3 个元素，重复...</span></div><div class="line">[<span class="number">0</span> <span class="number">2</span> <span class="number">4</span>]</div><div class="line">[<span class="number">1</span> <span class="number">3</span> <span class="number">5</span>]</div><div class="line">[ <span class="number">6</span>  <span class="number">8</span> <span class="number">10</span>]</div><div class="line">[ <span class="number">7</span>  <span class="number">9</span> <span class="number">11</span>]</div><div class="line">In [<span class="number">6</span>]: dataset = Dataset.range(<span class="number">12</span>)</div><div class="line">In [<span class="number">7</span>]: dataset = dataset.apply(tf.contrib.data.group_by_window(key_func=<span class="keyword">lambda</span> x: x%<span class="number">2</span>, reduce_func=<span class="keyword">lambda</span> x, els: els.batch(<span class="number">3</span>), window_size=<span class="number">5</span>))</div><div class="line">In [<span class="number">8</span>]: print_dataset(dataset) <span class="comment"># 这里 window_size 为 5，所以首先从双数数列取了 5 个元素，划分为 1 个大小为 3 的 batch 和 1 个大小为 2 的 batch，然后从单数数列取了 5 个，重复...</span></div><div class="line">[<span class="number">0</span> <span class="number">2</span> <span class="number">4</span>]</div><div class="line">[<span class="number">6</span> <span class="number">8</span>]</div><div class="line">[<span class="number">1</span> <span class="number">3</span> <span class="number">5</span>]</div><div class="line">[<span class="number">7</span> <span class="number">9</span>]</div><div class="line">[<span class="number">10</span>]</div><div class="line">[<span class="number">11</span>]</div></pre></td></tr></table></figure><p><a href="https://stackoverflow.com/questions/45292517/how-do-i-use-the-group-by-window-function-in-tensorflow" target="_blank" rel="external">stackoverflow 关于该函数使用的说明</a></p></li></ul><h1 id="tf-contrib-lookup"><a href="#tf-contrib-lookup" class="headerlink" title="tf.contrib.lookup"></a>tf.contrib.lookup</h1><h2 id="tf-contrib-lookup-HashTable"><a href="#tf-contrib-lookup-HashTable" class="headerlink" title="tf.contrib.lookup.HashTable"></a>tf.contrib.lookup.HashTable</h2><h3 id="lookup"><a href="#lookup" class="headerlink" title="lookup"></a>lookup</h3><ul><li><p>功能<br>根据 token 和 ID 的映射表，给出目标串的 ID</p></li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">lookup(</div><div class="line">    keys,</div><div class="line">    name=None</div><div class="line">)</div><div class="line"></div><div class="line">Args:</div><div class="line">keys: Keys to look up. May be either a SparseTensor or dense Tensor.</div><div class="line">name: A name for the operation (optional).</div><div class="line"></div><div class="line">Returns:</div><div class="line">A SparseTensor if keys are sparse, otherwise a dense Tensor.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ ipython</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">2</span>]: <span class="keyword">with</span>  tf.Session().as_default():</div><div class="line">   ...:     default_val = <span class="number">-1</span></div><div class="line">   ...:     keys = tf.constant([<span class="string">"brain"</span>, <span class="string">"salad"</span>, <span class="string">"surgery"</span>])</div><div class="line">   ...:     values = tf.constant([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>], tf.int64)</div><div class="line">   ...:     table = tf.contrib.lookup.HashTable(tf.contrib.lookup.KeyValueTensorInitializer(keys, values), default_val)</div><div class="line">   ...:     input_string = tf.constant([<span class="string">"brain"</span>, <span class="string">"salad"</span>, <span class="string">"tank"</span>])</div><div class="line">   ...:     table.init.run()</div><div class="line">   ...:     table.lookup(input_string).eval()</div><div class="line">Out[<span class="number">2</span>]: array([ <span class="number">0</span>,  <span class="number">1</span>, <span class="number">-1</span>])</div></pre></td></tr></table></figure></li></ul><h2 id="tf-contrib-lookup-index-table-from-file"><a href="#tf-contrib-lookup-index-table-from-file" class="headerlink" title="tf.contrib.lookup.index_table_from_file"></a>tf.contrib.lookup.index_table_from_file</h2><ul><li>功能<br>根据字典文件，建立 token 到 ID 的映射</li><li><p>描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">index_table_from_file(</div><div class="line">    vocabulary_file=None,</div><div class="line">    num_oov_buckets=0,</div><div class="line">    vocab_size=None,</div><div class="line">    default_value=-1,</div><div class="line">    hasher_spec=tf.contrib.lookup.FastHashSpec,</div><div class="line">    key_dtype=tf.string,</div><div class="line">    name=None</div><div class="line">)</div><div class="line"></div><div class="line">Args:</div><div class="line">vocabulary_file: The vocabulary filename, may be a constant scalar Tensor.</div><div class="line">num_oov_buckets: 如果关键字未在字典里出现，关键字将使用 hash 算法指定 [vocabulary size, vocabulary size + num_oov_buckets - 1] 范围内的 ID,</div><div class="line">                 如果不指定 num_oov_buckets 则未知关键字的 ID 会被指定为 default_value</div><div class="line">vocab_size:      Number of the elements in the vocabulary, if known.</div><div class="line">default_value:   The value to use for out-of-vocabulary feature values. Defaults to -1.</div><div class="line">hasher_spec:     A HasherSpec to specify the hash function to use for assignation of out-of-vocabulary buckets.</div><div class="line">key_dtype:       The key data type.</div><div class="line">name:            A name for this op (optional).</div><div class="line"></div><div class="line">Returns:</div><div class="line">返回一个 tf.contrib.lookup.HashTable 对象</div><div class="line">The lookup table to map a key_dtype Tensor to index int64 Tensor.</div></pre></td></tr></table></figure></li><li><p>示例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">$ cat &gt; /tmp/test.txt</div><div class="line">emerson</div><div class="line">lake</div><div class="line">palmer</div><div class="line"></div><div class="line">$ ipython</div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line">In [<span class="number">2</span>]: features = tf.constant([<span class="string">"emerson"</span>, <span class="string">"lake"</span>, <span class="string">"and"</span>, <span class="string">"palmer"</span>])</div><div class="line">In [<span class="number">3</span>]: table = tf.contrib.lookup.index_table_from_file(vocabulary_file=<span class="string">"/tmp/test.txt"</span>, num_oov_buckets=<span class="number">1</span>)</div><div class="line">In [<span class="number">4</span>]: ids = table.lookup(features)</div><div class="line">In [<span class="number">5</span>]: <span class="keyword">with</span> tf.Session().as_default():</div><div class="line">   ...:     tf.tables_initializer().run()</div><div class="line">   ...:     ids.eval()</div><div class="line">   ...:</div><div class="line">Out[<span class="number">5</span>]: array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>])</div></pre></td></tr></table></figure></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="http://blog.csdn.net/linuxandroidwince/article/details/78551022" target="_blank" rel="external">TensorFlow 全新的数据读取方式：Dataset API 入门教程</a></p></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Tensorflow/" rel="tag"># Tensorflow</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/11/23/generate-code.html" rel="next" title="利用深度学习探索代码生成任务"><i class="fa fa-chevron-left"></i> 利用深度学习探索代码生成任务</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2017/11/28/python-file-op.html" rel="prev" title="python 文件操作相关函数">python 文件操作相关函数 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview">站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="JIE XIAO"><p class="site-author-name" itemprop="name">JIE XIAO</p><p class="site-description motion-element" itemprop="description">will be better</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">6</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">15</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/jiexiao111" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:jiexiao111@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-globe"></i>E-Mail</a></span></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#tf"><span class="nav-number">1.</span> <span class="nav-text">tf</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Building-Graphs"><span class="nav-number">1.1.</span> <span class="nav-text">Building Graphs</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Defining-new-operations"><span class="nav-number">1.1.1.</span> <span class="nav-text">Defining new operations</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#tf-TensorShape"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">tf.TensorShape</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Constants-Sequences-and-Random-Values"><span class="nav-number">1.2.</span> <span class="nav-text">Constants, Sequences, and Random Values</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Constant-Value-Tensors"><span class="nav-number">1.2.1.</span> <span class="nav-text">Constant Value Tensors</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#tf-fill"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">tf.fill</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sequences"><span class="nav-number">1.2.2.</span> <span class="nav-text">Sequences</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#tf-range"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">tf.range</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Control-Flow"><span class="nav-number">1.3.</span> <span class="nav-text">Control Flow</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Logical-Operators"><span class="nav-number">1.3.1.</span> <span class="nav-text">Logical Operators</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#tf-logical-and-tf-logical-or-tf-logical-xor-tf-logical-not"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">tf.logical_and/tf.logical_or/tf.logical_xor/tf.logical_not</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Math"><span class="nav-number">1.4.</span> <span class="nav-text">Math</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Basic-Math-Functions"><span class="nav-number">1.4.1.</span> <span class="nav-text">Basic Math Functions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#tf-maximum"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">tf.maximum</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tf-minimum"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">tf.minimum</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Strings"><span class="nav-number">1.5.</span> <span class="nav-text">Strings</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Splitting"><span class="nav-number">1.5.1.</span> <span class="nav-text">Splitting</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#tf-string-split"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">tf.string_split</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Tensor-Transformations"><span class="nav-number">1.6.</span> <span class="nav-text">Tensor Transformations</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Casting"><span class="nav-number">1.6.1.</span> <span class="nav-text">Casting</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#tf-cast"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">tf.cast</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tf-to-int64"><span class="nav-number">1.6.1.2.</span> <span class="nav-text">tf.to_int64</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Shapes-and-Shaping"><span class="nav-number">1.6.2.</span> <span class="nav-text">Shapes and Shaping</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#tf-reshape"><span class="nav-number">1.6.2.1.</span> <span class="nav-text">tf.reshape</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tf-size"><span class="nav-number">1.6.2.2.</span> <span class="nav-text">tf.size</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Slicing-and-Joining"><span class="nav-number">1.6.3.</span> <span class="nav-text">Slicing and Joining</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#tf-concat"><span class="nav-number">1.6.3.1.</span> <span class="nav-text">tf.concat</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tf-reverse"><span class="nav-number">1.6.3.2.</span> <span class="nav-text">tf.reverse</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Variables"><span class="nav-number">1.7.</span> <span class="nav-text">Variables</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sharing-Variables"><span class="nav-number">1.7.1.</span> <span class="nav-text">Sharing Variables</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#tf-random-uniform-initializer"><span class="nav-number">1.7.1.1.</span> <span class="nav-text">tf.random_uniform_initializer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tf-VariableScope"><span class="nav-number">1.7.1.2.</span> <span class="nav-text">tf.VariableScope</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#set-initializer"><span class="nav-number">1.7.1.2.1.</span> <span class="nav-text">set_initializer</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#tf-data"><span class="nav-number">2.</span> <span class="nav-text">tf.data</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#tf-data-Dataset"><span class="nav-number">2.1.</span> <span class="nav-text">tf.data.Dataset</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#apply"><span class="nav-number">2.1.1.</span> <span class="nav-text">apply</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#filter"><span class="nav-number">2.1.2.</span> <span class="nav-text">filter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#make-initializable-iterator"><span class="nav-number">2.1.3.</span> <span class="nav-text">make_initializable_iterator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#make-one-shot-iterator"><span class="nav-number">2.1.4.</span> <span class="nav-text">make_one_shot_iterator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#map"><span class="nav-number">2.1.5.</span> <span class="nav-text">map</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#padded-batch"><span class="nav-number">2.1.6.</span> <span class="nav-text">padded_batch</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#prefetch"><span class="nav-number">2.1.7.</span> <span class="nav-text">prefetch</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#shard"><span class="nav-number">2.1.8.</span> <span class="nav-text">shard</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#shuffle"><span class="nav-number">2.1.9.</span> <span class="nav-text">shuffle</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#skip"><span class="nav-number">2.1.10.</span> <span class="nav-text">skip</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#zip"><span class="nav-number">2.1.11.</span> <span class="nav-text">zip</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tf-data-Iterator"><span class="nav-number">2.2.</span> <span class="nav-text">tf.data.Iterator</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#get-next"><span class="nav-number">2.2.1.</span> <span class="nav-text">get_next</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tf-data-TextLineDataset"><span class="nav-number">2.3.</span> <span class="nav-text">tf.data.TextLineDataset</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#tf-contrib-data"><span class="nav-number">3.</span> <span class="nav-text">tf.contrib.data</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#tf-contrib-data-group-by-window"><span class="nav-number">3.1.</span> <span class="nav-text">tf.contrib.data.group_by_window</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#tf-contrib-lookup"><span class="nav-number">4.</span> <span class="nav-text">tf.contrib.lookup</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#tf-contrib-lookup-HashTable"><span class="nav-number">4.1.</span> <span class="nav-text">tf.contrib.lookup.HashTable</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#lookup"><span class="nav-number">4.1.1.</span> <span class="nav-text">lookup</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tf-contrib-lookup-index-table-from-file"><span class="nav-number">4.2.</span> <span class="nav-text">tf.contrib.lookup.index_table_from_file</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考"><span class="nav-number">5.</span> <span class="nav-text">参考</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2017</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">JIE XIAO</span></div><div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div><span class="post-meta-divider">|</span><div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i> 访问 <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人 </span><span class="site-pv"><i class="fa fa-eye"></i> 浏览 <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;w<0&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.2"></script></body></html><!-- rebuild by neat -->